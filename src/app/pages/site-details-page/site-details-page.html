<app-header></app-header>

<div class="site-details-container">
  <button class="back-btn" (click)="goToSites()">← Back</button>

  @if (isLoading) {
    <div class="loading-state">
      <span class="spinner"></span>
      <p>Loading...</p>
    </div>
  }

  @if (errorMessage) {
    <div class="error-message">{{ errorMessage }}</div>
  }

  @if (site) {
    <div class="site-content">
      <h1 class="page-title">{{ site.siteName }}</h1>
      <p class="location-info">{{ site.municipality }}, {{ site.region }}, {{ site.country }}</p>

      <div class="main-layout">
        <div class="column-left">
          
          <section class="info-card">
            <h2>Site Overview</h2>
            <div class="details-grid">
              <div><strong>Country: </strong> <span>{{ site.country }}</span></div>
              <div><strong>Region: </strong> <span>{{ site.region }}</span></div>
              <div><strong>Municipality: </strong> <span>{{ site.municipality }}</span></div>
              <div><strong>Latitude: </strong> <span>{{ site.latitude }}</span></div>
              <div><strong>Longitude: </strong> <span>{{ site.longitude }}</span></div>
            </div>
          </section>
          
          @for (type of unitTypes; track type) {
            @if (groupedUnits[type] && groupedUnits[type]!.length > 0) {
              <section class="individuals-card">
                
                <h2>{{ getUnitTypeLabel(type) }} ({{ groupedUnits[type]?.length }})</h2>

                <table class="paleo-table">
                  <thead>
                    <tr>
                      @if (type === 'individual') {
                        <th>Name</th>
                        <th>Age</th>
                        <th>Sex</th>
                      }
                      <th>Culture</th>
                      <th>Context</th>
                      @if (type !== 'individual') {
                        <th>MNI</th>
                      }
                      <th></th>
                    </tr>
                  </thead>
                  <tbody>
                    @for (unit of groupedUnits[type]; track unit.osteologicalUnitId) {
                      <tr [routerLink]="['/unit', unit.osteologicalUnitId]" class="clickable-row">
                        @if (type === 'individual') {
                          <td class="text-black"><strong>{{ unit.individuals?.[0]?.individualName || '—' }}</strong></td>
                          <td class="text-black">{{ unit.individuals?.[0]?.ageAtDeath || '—' }}</td>
                          <td class="text-black">{{ unit.individuals?.[0]?.sex || '—' }}</td>
                        }
                        <td class="text-black">{{ unit.culturalAttribution || '—' }}</td>
                        <td class="text-black">{{ unit.stratigraphicContext || '—' }}</td>
                        @if (type !== 'individual') {
                          <td class="text-black">{{ unit.mniStatistical }}</td>
                        }
                      </tr>
                    }
                  </tbody>
                </table>
              </section>
            }
          }
        </div>

        <div class="column-right">
          <section class="map-card">
            <h2>Location</h2>
            <div class="map-container-wrapper">
            </div>
          </section>
        </div>

      </div>
    </div>
  }
</div>

<app-footer></app-footer>